#!/usr/bin/env python3

import re
import os
import os.path

import sys

if len(sys.argv) != 4:
    print('usage: recursive-replace search replace dir') 

for dirpath, dirnames, filenames in os.walk(sys.argv[3]):
    for filename in filenames:
        print(os.path.join(dirpath, filename))
        try:
            with open(os.path.join(dirpath, filename), 'r+') as f:
                contents = f.read()
                contents = re.sub(sys.argv[1], sys.argv[2], contents)
                f.seek(0)
                f.write(contents)
                f.truncate()
        except Exception as e:
            print(e)
